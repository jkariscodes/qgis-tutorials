<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Создание модуля на Python &mdash; QGIS Tutorials and Tips</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootswatch-3.2.0/united/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.2.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="QGIS Tutorials and Tips" href="../index.html" />

<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

<!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-690672-13', 'qgistutorials.com');
  ga('require', 'displayfeatures');
  ga('send', 'pageview');
</script>


  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html"><img src="../_static/logo.png">
          QGIS Tutorials and Tips</a>
        <span class="navbar-text navbar-version pull-left"><b>v1.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Tutorials List <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Введение</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/making_a_map.html">Making a Map (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="working_with_attributes.html">Работа с атрибутами</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/importing_spreadsheets_csv.html">Importing Spreadsheets or CSV files (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="using_plugins.html">Использование модулей расширения</a></li>
<li class="toctree-l1"><a class="reference internal" href="downloading_osm_data.html">Поиск и загрузка данных OpenStreetMap</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic_vector_styling.html">Основная стилизация векторного слоя</a></li>
<li class="toctree-l1"><a class="reference internal" href="calculating_line_lengths.html">Подсчёт длины линий и статистики</a></li>
<li class="toctree-l1"><a class="reference internal" href="raster_styling_and_analysis.html">Основы работы со стилями и анализа растровых данных</a></li>
<li class="toctree-l1"><a class="reference internal" href="raster_mosaicing_and_clipping.html">Создание мозаик и обрезка растров</a></li>
<li class="toctree-l1"><a class="reference internal" href="working_with_terrain.html">Работа с цифровой моделью рельефа</a></li>
<li class="toctree-l1"><a class="reference internal" href="working_with_wms.html">Работа с данными WMS</a></li>
<li class="toctree-l1"><a class="reference internal" href="working_with_projections.html">Working with Projections</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/georeferencing_basics.html">Georeferencing Topo Sheets and Scanned Maps (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/advanced_georeferencing.html">Georeferencing Aerial Imagery (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="digitizing_basics.html">Оцифровка картографических данных</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/performing_table_joins.html">Performing Table Joins (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="performing_spatial_joins.html">Выполнение пространственных присоединений</a></li>
<li class="toctree-l1"><a class="reference internal" href="points_in_polygon.html">Анализ количества точек в полигонах</a></li>
<li class="toctree-l1"><a class="reference internal" href="creating_heatmaps.html">Создание тепловых карт</a></li>
<li class="toctree-l1"><a class="reference internal" href="performing_spatial_queries.html">Выполнение пространственных запросов</a></li>
<li class="toctree-l1"><a class="reference internal" href="nearest_neighbor_analysis.html">Анализ ближайшего соседства</a></li>
<li class="toctree-l1"><a class="reference internal" href="sampling_raster_data.html">Отбор проб растровых данных с помощью точек или полигонов</a></li>
<li class="toctree-l1"><a class="reference internal" href="interpolating_point_data.html">Интерполяция точечных данных</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/batch_processing.html">Batch Processing using Processing Framework (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/processing_graphical_modeler.html">Automating Complex Workflows using Processing Modeler (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/automating_map_creation.html">Automating Map Creation with Print Layout Atlas (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="using_qgis_browser.html">Использование QGIS Browser</a></li>
<li class="toctree-l1"><a class="reference internal" href="counting_vertices.html">Подсчет числа вершин в слое</a></li>
<li class="toctree-l1"><a class="reference internal" href="open_bil_bip_bsq_files.html">Открытие файлов BIL, BIP или BSQ в QGIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/getting_started_with_pyqgis.html">Getting Started With Python Programming (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/building_a_python_plugin.html">Building a Python Plugin (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/custom_python_functions.html">Using Custom Python Expression Functions (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/processing_python_scripts.html">Writing Python Scripts for Processing Framework (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="running_qgis_jobs.html">Running and Scheduling QGIS Processing Jobs</a></li>
<li class="toctree-l1"><a class="reference internal" href="find_neighbor_polygons.html">Нахождение соседних полигонов в слое</a></li>
<li class="toctree-l1"><a class="reference internal" href="performing_table_joins_pyqgis.html">Performing Table Joins (PyQGIS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="web_mapping_with_qgis2web.html">Веб картография с QGIS2Web</a></li>
<li class="toctree-l1"><a class="reference internal" href="creating_basemaps_with_qtiles.html">Creating Basemaps with QTiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="learning_resources.html">Учебные материалы по QGIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="credits.html">Источники данных</a></li>
<li class="toctree-l1"><a class="reference internal" href="batch_processing.html">Batch Processing using Processing Framework (QGIS2)</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            

            

            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><h4>Author</h4>
<p>Ujaval Gandhi</p>
<a href="https://twitter.com/intent/follow?screen_name=spatialthoughts" class="twitter-follow-button" data-show-count="false">Follow @spatialthoughts</a>

<!-- Begin Mailchimp Signup Form -->
<link href="//cdn-images.mailchimp.com/embedcode/slim-10_7.css" rel="stylesheet" type="text/css">
<style type="text/css">
	#mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; }
	/* Add your own Mailchimp form style overrides in your site stylesheet or in this style block.
	   We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
<div id="mc_embed_signup">
<h4>Subscribe to my mailing list</h4>
<p>Get occasional emails when I post new material or announce training events.</p>
<form action="https://spatialthoughts.us20.list-manage.com/subscribe/post?u=59d493847a7c7c2dbf12b21e6&amp;id=8fb09ab55c" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
	<input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_59d493847a7c7c2dbf12b21e6_8fb09ab55c" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
</form>
</div>

<!--End mc_embed_signup-->

<h4>Change Language</h4>
<form role="form" class="sidebar-form sidebar-left">
<select id="languages" class="form-control select-mini">
  <option value="en">English</option>
  <option value="zh_TW">Chinese (Taiwan)</option>
  <option value="nl">Dutch</option>
  <option value="fi_FI">Finnish</option>
  <option value="fr">French</option>
  <option value="de">German</option>
  <option value="el">Greek</option>
  <option value="id">Indonesian</option>
  <option value="it">Italian</option>
  <option value="ko">Korean</option>
  <option value="pt_BR">Portuguese</option>
  <option value="ro">Romanian</option>
  <option value="ru">Russian</option>
  <option value="sl">Slovenian</option>
  <option value="es">Spanish</option>
  <option value="th">Thai</option>
  <option value="tr">Turkish</option>
  <option value="uk">Ukrainian</option>
  <option value="vi">Vietnamese</option>
</select>
</form>
        </div>
      </div>
    <div class="col-md-9">
      

  <div class="section" id="building-a-python-plugin">
<h1>Создание модуля на Python<a class="headerlink" href="#building-a-python-plugin" title="Ссылка на этот заголовок">¶</a></h1>
<div class="admonition warning">
<p class="first admonition-title">Предупреждение</p>
<p class="last">A new version of this tutorial is available at <a class="reference internal" href="3/building_a_python_plugin.html"><em>Building a Python Plugin (QGIS3)</em></a></p>
</div>
<p>Модули - это отличный способ расширить функциональность QGIS. Вы можете создавать модули на Python, от добавления простой кнопки до сложных наборов инструментов. Этот урок в общих чертах покажет процесс, связанный с настройкой среды разработки, проектированием пользовательского интерфейса для модуля и написанием кода для взаимодействия с QGIS. Пожалуйста, просмотрите урок <a class="reference internal" href="getting_started_with_pyqgis.html"><em>Первые шаги в программировании на Python</em></a>, чтобы ознакомиться с основами.</p>
<div class="section" id="overview-of-the-task">
<h2>Обзор задачи<a class="headerlink" href="#overview-of-the-task" title="Ссылка на этот заголовок">¶</a></h2>
<p>Мы разработаем простой модуль под названием <code class="docutils literal"><span class="pre">Save</span> <span class="pre">Attributes</span></code>, который позволит пользователям выбрать векторный слой и записать его атрибуты в CSV-файл.</p>
</div>
<div class="section" id="get-the-tools">
<h2>Получение инструментов<a class="headerlink" href="#get-the-tools" title="Ссылка на этот заголовок">¶</a></h2>
<div class="section" id="qt-creator">
<h3>Qt Creator<a class="headerlink" href="#qt-creator" title="Ссылка на этот заголовок">¶</a></h3>
<p><a class="reference external" href="http://www.qt.io/">Qt</a> это фреймворк для разработки программного обеспечения, который используется для разработки приложений, работающих на Windows, Mac, Linux, а также на различных мобильных операционных системах. Сам QGIS написан с использованием Qt. Для разработки модулей мы будем использовать приложение под названием <a class="reference external" href="http://doc.qt.io/qtcreator/index.html">Qt Creator</a>, чтобы разработать интерфейс для нашего модуля.</p>
<p>Загрузите и установите приложение Qt Creator с <a class="reference external" href="http://sourceforge.net/projects/qtcreator.mirror/files/latest/download">SourgeForge</a></p>
</div>
<div class="section" id="python-bindings-for-qt">
<h3>Связки Python для Qt<a class="headerlink" href="#python-bindings-for-qt" title="Ссылка на этот заголовок">¶</a></h3>
<p>Так как мы разрабатываем модуль на Python, нам необходимо установить расширение Python для Qt. Способ его установки будут зависеть от платформы, которую вы используете. Для создания модулей нам нужен инструмент командной строки <code class="docutils literal"><span class="pre">pyrcc4</span></code>.</p>
<p><strong>Windows</strong></p>
<p>Скачайте <a class="reference external" href="http://trac.osgeo.org/osgeo4w/">установочный файл OSGeo4W</a> и выберите <span class="guilabel">Express Desktop Install</span>. Установите пакет <code class="docutils literal"><span class="pre">QGIS</span></code>. После установки вы сможете получить доступ к инструменту <code class="docutils literal"><span class="pre">pyrcc4</span></code> через <span class="guilabel">OSGeo4W Shell</span>.</p>
<p><strong>Mac</strong></p>
<p>Установите менеджер пакетов <a class="reference external" href="http://brew.sh">Homebrew</a> . Установите пакет <code class="docutils literal"><span class="pre">PyQt</span></code>, выполнив следующую команду:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>brew install pyqt
</pre></div>
</div>
<p><strong>Linux</strong></p>
<p>В зависимости от вашего дистрибутива, найдите и установите пакет <code class="docutils literal"><span class="pre">python-qt4</span></code>. В дистрибутивах, основанных на Ubuntu и Debian, вы можете запустить следующую команду:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>sudo apt-get install python-qt4
</pre></div>
</div>
</div>
<div class="section" id="a-text-editor-or-a-python-ide">
<h3>Текстовый редактор или интегрированная среда разработки Python<a class="headerlink" href="#a-text-editor-or-a-python-ide" title="Ссылка на этот заголовок">¶</a></h3>
<p>Any kind of software development requires a good text editor. If you already
have a favorite text editor or an IDE (Integrated Development Environment), you
may use it for this tutorial. Otherwise, each platform offers a wide variety of
free or paid options for text editors. Choose the one that fits your needs.</p>
<p>В этом уроке используется редактор Notepad ++ на Windows.</p>
<p><strong>Windows</strong></p>
<p><a class="reference external" href="http://notepad-plus-plus.org/">Notepad++</a> - это хороший бесплатный редактор для Windows. Скачайте и установите <a class="reference external" href="http://notepad-plus-plus.org/repository/6.x/6.7.5/npp.6.7.5.Installer.exe">редактор Notepad++</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Если вы используете Notepad++, убедитесь, что отмечена настройка <span class="guilabel">Replace by space</span> в меню  <span class="menuselection">Settings ‣ Preferences ‣ Tab Settings</span>. Python очень чувствителен к пробелам, и эта настройка гарантирует, что табуляции и пробелы обрабатываются корректно.</p>
</div>
</div>
<div class="section" id="plugin-builder-plugin">
<h3>Модуль Plugin Builder<a class="headerlink" href="#plugin-builder-plugin" title="Ссылка на этот заголовок">¶</a></h3>
<p>There is a helpful QGIS plugin named <code class="docutils literal"><span class="pre">Plugin</span> <span class="pre">Builder</span></code> which creates all the
necessary files and the boilerplate code for a plugin. Find and install the
<code class="docutils literal"><span class="pre">Plugin</span> <span class="pre">Builder</span></code> plugin. See <a class="reference internal" href="using_plugins.html"><em>Использование модулей расширения</em></a> for more details on how to
install plugins.</p>
</div>
<div class="section" id="plugins-reloader-plugin">
<h3>Модуль Plugins Reloader<a class="headerlink" href="#plugins-reloader-plugin" title="Ссылка на этот заголовок">¶</a></h3>
<p>Это еще один полезный модуль, который позволяет разрабатывать модули итеративно. Используя этот модуль, вы можете изменять код своего модуля, и перемены будут отражены в QGIS без необходимости перезагружать QGIS каждый раз. Найдите и установите модуль <code class="docutils literal"><span class="pre">Plugin</span> <span class="pre">Reloader</span></code>. Подробнее об установке модулей можно прочитать тут: <a class="reference internal" href="using_plugins.html"><em>Использование модулей расширения</em></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Plugin Reloader является экспериментальным модулем. Убедитесь, что вы отметили галочкой опцию <span class="guilabel">Show also experimental plugins</span> в настройках <span class="guilabel">Plugin Manager</span>, если вы не можете его найти.</p>
</div>
</div>
</div>
<div class="section" id="procedure">
<h2>Методика<a class="headerlink" href="#procedure" title="Ссылка на этот заголовок">¶</a></h2>
<ol class="arabic simple">
<li><p class="first">Откройте QGIS. Перейдите к меню <span class="menuselection">Plugins ‣ Plugin Builder ‣ Plugin Builder</span>.</p>
</li>
</ol>
<img alt="../_images/180.png" class="align-center" src="../_images/180.png" />
<ol class="arabic simple" start="2">
<li><p class="first">Вы увидите диалоговое окно <span class="guilabel">QGIS Plugin Builder</span> с формой. Вы можете заполнить форму, указав детали, касающиеся нашего модуля. В поле <span class="guilabel">Class name</span> нужно указать имя класса Python, содержащего логику модуля. Это также будет имя папки, содержащей все файлы модуля. Введите строку <code class="docutils literal"><span class="pre">SaveAttributes</span></code> в качестве имени класса. <span class="guilabel">Plugin name</span> - это имя, под которым ваш плагин появится в меню <span class="guilabel">Plugin Manager</span>. Введите `` Save Attributes``. Добавьте описание в поле <span class="guilabel">Description</span>. <span class="guilabel">Module name</span> - это имя основного файла Python для модуля. Укажите его как <code class="docutils literal"><span class="pre">safe_attributes</span></code>. Оставьте номер версии без изменения. Строка <span class="guilabel">Text for menu item</span> указывает, как пользователи будут видеть ваш плагин в меню QGIS. Введите <code class="docutils literal"><span class="pre">Save</span> <span class="pre">Attributes</span> <span class="pre">as</span> <span class="pre">CSV</span></code>. Введите свое имя и адрес электронной почты в соответствующих полях. Поле <span class="guilabel">Menu</span> показывает, в какое меню QGIS будет добавлен ваш модуль. Так как наш плагин предназначен для векторных данных, выберите <code class="docutils literal"><span class="pre">Vector</span></code>. Отметьте галочкой поле <span class="guilabel">Flag the plugin as experimental</span> в нижней части. Нажмите <span class="guilabel">OK</span>.</p>
</li>
</ol>
<img alt="../_images/236.png" class="align-center" src="../_images/236.png" />
<ol class="arabic simple" start="3">
<li><p class="first">Далее вам будет предложено выбрать каталог для вашего модуля. Вы должны перейти к папке модулей QGIS на вашем компьютере и нажать <span class="guilabel">Select Folder</span>. Как правило, папка <code class="docutils literal"><span class="pre">.qgis2/</span></code> находится в вашей домашнем каталоге. Местоположение папки <code class="docutils literal"><span class="pre">plugin</span></code> будет зависеть от вашей платформы следующим образом: (Замените <code class="docutils literal"><span class="pre">username</span></code> на ваше имя пользователя)</p>
</li>
</ol>
<p><strong>Windows</strong></p>
<div class="highlight-none"><div class="highlight"><pre><span></span>c:\Users\username\.qgis2\python\plugins
</pre></div>
</div>
<p><strong>Mac</strong></p>
<div class="highlight-none"><div class="highlight"><pre><span></span>/Users/username/.qgis2/python/plugins
</pre></div>
</div>
<p><strong>Linux</strong></p>
<div class="highlight-none"><div class="highlight"><pre><span></span>/home/username/.qgis2/python/plugins
</pre></div>
</div>
<img alt="../_images/333.png" class="align-center" src="../_images/333.png" />
<ol class="arabic simple" start="4">
<li><p class="first">Вы увидите диалоговое окно подтверждения при создании шаблона вашего модуля. Обратите внимание на путь к папке с модулем.</p>
</li>
</ol>
<img alt="../_images/415.png" class="align-center" src="../_images/415.png" />
<ol class="arabic simple" start="5">
<li><p class="first">Прежде чем мы сможем использовать вновь созданный плагин, мы должны скомпилировать файл <code class="docutils literal"><span class="pre">resources.qrc</span></code>, который был создан модулем Plugin Builder. Запустите <span class="guilabel">OSGeo4W Shell</span> под Windows или в терминале на Mac или Linux.</p>
</li>
</ol>
<img alt="../_images/515.png" class="align-center" src="../_images/515.png" />
<ol class="arabic simple" start="6">
<li><p class="first">Перейдите к папке модуля, в которой были созданы файлы с помощью модуля <code class="docutils literal"><span class="pre">Plugin</span> <span class="pre">Builder</span></code>. Вы можете использовать команду <code class="docutils literal"><span class="pre">cd</span></code> с последующим указанием пути к директории.</p>
</li>
</ol>
<div class="highlight-none"><div class="highlight"><pre><span></span>cd c:\Users\username\.qgis2\python\plugins\SaveAttributes
</pre></div>
</div>
<img alt="../_images/614.png" class="align-center" src="../_images/614.png" />
<ol class="arabic simple" start="7">
<li><p class="first">Оказавшись в каталоге, напечатайте <code class="docutils literal"><span class="pre">make</span></code>. Это запустит команду <code class="docutils literal"><span class="pre">pyrcc4</span></code>, которую мы установили, как часть расширения Qt для Python.</p>
</li>
</ol>
<div class="highlight-none"><div class="highlight"><pre><span></span>make
</pre></div>
</div>
<img alt="../_images/714.png" class="align-center" src="../_images/714.png" />
<ol class="arabic simple" start="8">
<li>Now we are ready to have a first look at the brand new plugin we created.
Close QGIS and launch it again. Go to <span class="menuselection">Plugins ‣ Manage
and Install plugins</span> and enable the <code class="docutils literal"><span class="pre">Save</span> <span class="pre">Attributes</span></code> plugin in the
<span class="guilabel">Installed</span> tab. You will notice that there is a new icon
in the toolbar and a new menu entry under <span class="menuselection">Vector
‣ Save Attributes ‣ Save Attributes as CSV`</span>. Select it to launch
the plugin dialog.</li>
</ol>
<img alt="../_images/813.png" class="align-center" src="../_images/813.png" />
<ol class="arabic simple" start="9">
<li><p class="first">Вы заметите новое пустое диалоговое окно под названием <span class="guilabel">Save Attributes</span>. Закройте это окно.</p>
</li>
</ol>
<img alt="../_images/914.png" class="align-center" src="../_images/914.png" />
<ol class="arabic simple" start="10">
<li>We will now design our dialog box and add some user interface elements to
it. Open the <code class="docutils literal"><span class="pre">Qt</span> <span class="pre">Creator</span></code> program and to to <span class="guilabel">File &#8211;&gt; Open File
or Project...</span>.</li>
</ol>
<img alt="../_images/1013.png" class="align-center" src="../_images/1013.png" />
<ol class="arabic simple" start="11">
<li><p class="first">Перейдите к папке с модулем и выберите файл <code class="docutils literal"><span class="pre">save_attributes_dialog_base.ui</span></code>. Нажмите <span class="guilabel">Open</span>.</p>
</li>
</ol>
<img alt="../_images/1118.png" class="align-center" src="../_images/1118.png" />
<ol class="arabic simple" start="12">
<li><p class="first">Вы увидите пустое диалоговое окно модуля. Вы можете перетаскивать элементы из панели слева в диалоговое окно. Мы добавим <span class="guilabel">Input Widget</span> вида <span class="guilabel">Combo Box</span>. Перетащите его в диалоговое окно модуля.</p>
</li>
</ol>
<img alt="../_images/1216.png" class="align-center" src="../_images/1216.png" />
<ol class="arabic simple" start="13">
<li><p class="first">Настройте подходящий размер поля со списком. Теперь перетащите элемент <span class="guilabel">Display Widget</span> типа <span class="guilabel">Label</span> в диалоговое окно.</p>
</li>
</ol>
<img alt="../_images/1315.png" class="align-center" src="../_images/1315.png" />
<ol class="arabic simple" start="14">
<li><p class="first">Щелкните на тексте и введите <code class="docutils literal"><span class="pre">Select</span> <span class="pre">a</span> <span class="pre">layer</span></code>.</p>
</li>
</ol>
<img alt="../_images/1414.png" class="align-center" src="../_images/1414.png" />
<ol class="arabic simple" start="15">
<li><p class="first">Сохраните этот файл, перейдя в <span class="menuselection">File ‣ Save save_attributes_dialog_base.ui</span>. Заметьте, что имя объекта поля со списком - <code class="docutils literal"><span class="pre">comboBox</span></code>. Для взаимодействия с этим объектом через код Python, мы должны обратиться к нему по этому имени.</p>
</li>
</ol>
<img alt="../_images/1513.png" class="align-center" src="../_images/1513.png" />
<ol class="arabic simple" start="16">
<li><p class="first">Давайте перезагрузим наш модуль, чтобы мы могли видеть изменения в диалоговом окне. Перейдите к <span class="menuselection">Plugin ‣ Plugin Reloader ‣ Choose a plugin to be reloaded</span>.</p>
</li>
</ol>
<img alt="../_images/1612.png" class="align-center" src="../_images/1612.png" />
<ol class="arabic simple" start="17">
<li><p class="first">Выберите <code class="docutils literal"><span class="pre">SaveAttributes</span></code> в диалоговом окне <span class="guilabel">Configure Plugin reloader</span>.</p>
</li>
</ol>
<img alt="../_images/1712.png" class="align-center" src="../_images/1712.png" />
<ol class="arabic simple" start="18">
<li><p class="first">Теперь нажмите кнопку <span class="guilabel">Save Attributes as CSV</span>. Вы увидите только что созданное диалоговое окно.</p>
</li>
</ol>
<img alt="../_images/1813.png" class="align-center" src="../_images/1813.png" />
<ol class="arabic simple" start="19">
<li><p class="first">Давайте добавим в модуль алгоритм, заполняющий выпадающий список слоями, загружаенными в QGIS. Перейдите в папку модуля и откройте файл <code class="docutils literal"><span class="pre">save_attributes.py</span></code> в текстовом редакторе. Прокрутите вниз и найдите метод <code class="docutils literal"><span class="pre">run(self)</span></code>. Этот метод будет вызываться, когда вы нажмете кнопку на панели инструментов или выберете пункт меню модуля. Добавьте следующий код в начале метода. Этот код получает слои, загруженные в QGIS, и добавляет их в объект <code class="docutils literal"><span class="pre">comboBox</span></code> из диалогового окна модуля.</p>
</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">layers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">legendInterface</span><span class="p">()</span><span class="o">.</span><span class="n">layers</span><span class="p">()</span>
<span class="n">layer_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>
     <span class="n">layer_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">name</span><span class="p">())</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">comboBox</span><span class="o">.</span><span class="n">addItems</span><span class="p">(</span><span class="n">layer_list</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/199.png" class="align-center" src="../_images/199.png" />
<ol class="arabic simple" start="20">
<li><p class="first">Вернитесь в главное окно QGIS, перезагрузите модуль, перейдя к <span class="menuselection">Plugins ‣ Plugin Reloader ‣ Reload plugin: SaveAttributes</span>. Либо вы можете просто нажать <code class="kbd docutils literal"><span class="pre">F5</span></code>. Чтобы проверить эту новую функциональность, мы должны загрузить какие-то слои в QGIS. После того как вы загрузите данные, запустите модуль, перейдя к <span class="menuselection">Vector ‣ Save Attributes ‣ Save Attributes as CSV</span>.</p>
</li>
</ol>
<img alt="../_images/207.png" class="align-center" src="../_images/207.png" />
<ol class="arabic simple" start="21">
<li><p class="first">Вы увидите, что наш список теперь заполнен именами слоев, загруженных в QGIS.</p>
</li>
</ol>
<img alt="../_images/2114.png" class="align-center" src="../_images/2114.png" />
<ol class="arabic simple" start="22">
<li>Let&#8217;s add remaining user interface elements. Switch back to <code class="docutils literal"><span class="pre">Qt</span> <span class="pre">Creator</span></code>
and load the <code class="docutils literal"><span class="pre">save_attributes_dialog_base.ui</span></code> file. Add a <code class="docutils literal"><span class="pre">Label</span></code>
<span class="guilabel">Display Widget</span> and change the text to <code class="docutils literal"><span class="pre">Select</span> <span class="pre">output</span> <span class="pre">file</span></code>.
Add a <code class="docutils literal"><span class="pre">LineEdit</span></code> type <span class="guilabel">Input Widget</span> that will show the output
file path that the user has chosen. Next, add a <code class="docutils literal"><span class="pre">Push</span> <span class="pre">Button</span></code> type
<span class="guilabel">Button</span> and change the button label to <code class="docutils literal"><span class="pre">...</span></code>. Note the object
names of the widgets that we will have to use to interact with them. Save
the file.</li>
</ol>
<img alt="../_images/2211.png" class="align-center" src="../_images/2211.png" />
<ol class="arabic simple" start="23">
<li><p class="first">Теперь мы добавим код Python, который откроет файловый браузер, когда пользователь нажимает на кнопку  <code class="docutils literal"><span class="pre">...</span></code>, и покажет выбранный путь в строке редактирования. Откройте файл <code class="docutils literal"><span class="pre">save_attributes.py</span></code> в текстовом редакторе. Добавьте <code class="docutils literal"><span class="pre">QFileDialog</span></code> в наш список импорта в верхней части файла.</p>
</li>
</ol>
<img alt="../_images/237.png" class="align-center" src="../_images/237.png" />
<ol class="arabic simple" start="24">
<li><p class="first">Добавьте новый метод под названием <code class="docutils literal"><span class="pre">select_output_file</span></code> со следующим кодом. Этот код откроет файловый браузер и вставит в строку редактирования путь к файлу, выбранный пользователем.</p>
</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">select_output_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="p">,</span> <span class="s2">&quot;Select output file &quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s1">&#39;*.txt&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/246.png" class="align-center" src="../_images/246.png" />
<ol class="arabic simple" start="25">
<li>Now we need to add code so that when the <cite>...</cite> button is clicked,
<code class="docutils literal"><span class="pre">select_output_file</span></code> method is called. Scroll up to the <code class="docutils literal"><span class="pre">__init__</span></code>
method and add the following lines at the bottom. This code will clear the
previously loaded text (if any) in the line edit widget and also connect
the <code class="docutils literal"><span class="pre">select_output_file</span></code> method to the <code class="docutils literal"><span class="pre">clicked</span></code> signal of the push
button widget.</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">pushButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">select_output_file</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/256.png" class="align-center" src="../_images/256.png" />
<ol class="arabic simple" start="26">
<li><p class="first">Вернитесь в QGIS, перезагрузите плагин и откройте <span class="guilabel">Save Attributes`</span> dialog. Если все прошло нормально, вы сможете нажать на кнопку `` ... `` и выбрать текстовый файл вывода с вашего диска.</p>
</li>
</ol>
<img alt="../_images/266.png" class="align-center" src="../_images/266.png" />
<ol class="arabic simple" start="27">
<li><p class="first">При нажатии <span class="guilabel">OK</span> в диалоговом окне модуля ничего не происходит. Это потому, что мы не добавили алгоритм для извлечения атрибутов из слоя и записи его в текстовый файл. Теперь у нас есть все, чтобы сделать это. Найдите место в методе <code class="docutils literal"><span class="pre">run</span></code>, где написано <code class="docutils literal"><span class="pre">pass</span></code>. Замените его на код ниже. Объяснение этого кода можно найти в уроке <a class="reference internal" href="getting_started_with_pyqgis.html"><em>Первые шаги в программировании на Python</em></a>.</p>
</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>

<span class="n">selectedLayerIndex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">comboBox</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
<span class="n">selectedLayer</span> <span class="o">=</span> <span class="n">layers</span><span class="p">[</span><span class="n">selectedLayerIndex</span><span class="p">]</span>
<span class="n">fields</span> <span class="o">=</span> <span class="n">selectedLayer</span><span class="o">.</span><span class="n">pendingFields</span><span class="p">()</span>
<span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">()</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">]</span>

<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">selectedLayer</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">():</span>
    <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">unicode</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fieldnames</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">unicode_line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">unicode_line</span><span class="p">)</span>
<span class="n">output_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/276.png" class="align-center" src="../_images/276.png" />
<ol class="arabic simple" start="28">
<li><p class="first">Теперь наша модуль готов. Перезагрузите модуль и испробуйте его. Вы увидите, что выходной текстовый файл, который вы выбрали, будет иметь атрибуты из векторного слоя. Вы можете заархивировать папку с модулем и поделиться им с другими пользователями. Они смогут распаковать содержимое в их папку с модулями и попробовать ваш модуль. Если бы это был реальный модуль, вы бы загрузили его на <cite>QGIS Plugin Repository &lt;https://plugins.qgis.org/&gt;</cite> _, чтобы все пользователи QGIS смогли найти и скачать ваш модуль.</p>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Этот модуль предназначен только для демонстрационных целей. Не публикуйте этот модуль и не загружайте его в репозиторий модулей QGIS.</p>
</div>
<p>Ниже приводится полный текст файла <code class="docutils literal"><span class="pre">save_attributes.py</span></code>.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">/***************************************************************************</span>
<span class="sd"> SaveAttributes</span>
<span class="sd">                                 A QGIS plugin</span>
<span class="sd"> This plugin saves the attribute of the selected vector layer as a CSV file.</span>
<span class="sd">                              -------------------</span>
<span class="sd">        begin                : 2015-04-20</span>
<span class="sd">        git sha              : $Format:%H$</span>
<span class="sd">        copyright            : (C) 2015 by Ujaval Gandhi</span>
<span class="sd">        email                : ujaval@spatialthoughts.com</span>
<span class="sd"> ***************************************************************************/</span>

<span class="sd">/***************************************************************************</span>
<span class="sd"> *                                                                         *</span>
<span class="sd"> *   This program is free software; you can redistribute it and/or modify  *</span>
<span class="sd"> *   it under the terms of the GNU General Public License as published by  *</span>
<span class="sd"> *   the Free Software Foundation; either version 2 of the License, or     *</span>
<span class="sd"> *   (at your option) any later version.                                   *</span>
<span class="sd"> *                                                                         *</span>
<span class="sd"> ***************************************************************************/</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">PyQt4.QtCore</span> <span class="kn">import</span> <span class="n">QSettings</span><span class="p">,</span> <span class="n">QTranslator</span><span class="p">,</span> <span class="n">qVersion</span><span class="p">,</span> <span class="n">QCoreApplication</span>
<span class="kn">from</span> <span class="nn">PyQt4.QtGui</span> <span class="kn">import</span> <span class="n">QAction</span><span class="p">,</span> <span class="n">QIcon</span><span class="p">,</span> <span class="n">QFileDialog</span>
<span class="c1"># Initialize Qt resources from file resources.py</span>
<span class="kn">import</span> <span class="nn">resources_rc</span>
<span class="c1"># Import the code for the dialog</span>
<span class="kn">from</span> <span class="nn">save_attributes_dialog</span> <span class="kn">import</span> <span class="n">SaveAttributesDialog</span>
<span class="kn">import</span> <span class="nn">os.path</span>


<span class="k">class</span> <span class="nc">SaveAttributes</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;QGIS Plugin Implementation.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iface</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor.</span>

<span class="sd">        :param iface: An interface instance that will be passed to this class</span>
<span class="sd">            which provides the hook by which you can manipulate the QGIS</span>
<span class="sd">            application at run time.</span>
<span class="sd">        :type iface: QgsInterface</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Save reference to the QGIS interface</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">iface</span>
        <span class="c1"># initialize plugin directory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plugin_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
        <span class="c1"># initialize locale</span>
        <span class="n">locale</span> <span class="o">=</span> <span class="n">QSettings</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;locale/userLocale&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">locale_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plugin_dir</span><span class="p">,</span>
            <span class="s1">&#39;i18n&#39;</span><span class="p">,</span>
            <span class="s1">&#39;SaveAttributes_{}.qm&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">locale</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">locale_path</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">translator</span> <span class="o">=</span> <span class="n">QTranslator</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">translator</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">locale_path</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">qVersion</span><span class="p">()</span> <span class="o">&gt;</span> <span class="s1">&#39;4.3.3&#39;</span><span class="p">:</span>
                <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">installTranslator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">translator</span><span class="p">)</span>

        <span class="c1"># Create the dialog (after translation) and keep reference</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span> <span class="o">=</span> <span class="n">SaveAttributesDialog</span><span class="p">()</span>

        <span class="c1"># Declare instance attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;&amp;Save Attributes&#39;</span><span class="p">)</span>
        <span class="c1"># TODO: We are going to let the user set this up in a future iteration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">addToolBar</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;SaveAttributes&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;SaveAttributes&#39;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">pushButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">select_output_file</span><span class="p">)</span>
        

    <span class="c1"># noinspection PyMethodMayBeStatic</span>
    <span class="k">def</span> <span class="nf">tr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the translation for a string using Qt translation API.</span>

<span class="sd">        We implement this ourselves since we do not inherit QObject.</span>

<span class="sd">        :param message: String for translation.</span>
<span class="sd">        :type message: str, QString</span>

<span class="sd">        :returns: Translated version of message.</span>
<span class="sd">        :rtype: QString</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># noinspection PyTypeChecker,PyArgumentList,PyCallByClass</span>
        <span class="k">return</span> <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s1">&#39;SaveAttributes&#39;</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">add_action</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">icon_path</span><span class="p">,</span>
        <span class="n">text</span><span class="p">,</span>
        <span class="n">callback</span><span class="p">,</span>
        <span class="n">enabled_flag</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">add_to_menu</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">add_to_toolbar</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">status_tip</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
        <span class="n">whats_this</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
        <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a toolbar icon to the toolbar.</span>

<span class="sd">        :param icon_path: Path to the icon for this action. Can be a resource</span>
<span class="sd">            path (e.g. &#39;:/plugins/foo/bar.png&#39;) or a normal file system path.</span>
<span class="sd">        :type icon_path: str</span>

<span class="sd">        :param text: Text that should be shown in menu items for this action.</span>
<span class="sd">        :type text: str</span>

<span class="sd">        :param callback: Function to be called when the action is triggered.</span>
<span class="sd">        :type callback: function</span>

<span class="sd">        :param enabled_flag: A flag indicating if the action should be enabled</span>
<span class="sd">            by default. Defaults to True.</span>
<span class="sd">        :type enabled_flag: bool</span>

<span class="sd">        :param add_to_menu: Flag indicating whether the action should also</span>
<span class="sd">            be added to the menu. Defaults to True.</span>
<span class="sd">        :type add_to_menu: bool</span>

<span class="sd">        :param add_to_toolbar: Flag indicating whether the action should also</span>
<span class="sd">            be added to the toolbar. Defaults to True.</span>
<span class="sd">        :type add_to_toolbar: bool</span>

<span class="sd">        :param status_tip: Optional text to show in a popup when mouse pointer</span>
<span class="sd">            hovers over the action.</span>
<span class="sd">        :type status_tip: str</span>

<span class="sd">        :param parent: Parent widget for the new action. Defaults None.</span>
<span class="sd">        :type parent: QWidget</span>

<span class="sd">        :param whats_this: Optional text to show in the status bar when the</span>
<span class="sd">            mouse pointer hovers over the action.</span>

<span class="sd">        :returns: The action that was created. Note that the action is also</span>
<span class="sd">            added to self.actions list.</span>
<span class="sd">        :rtype: QAction</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">icon</span> <span class="o">=</span> <span class="n">QIcon</span><span class="p">(</span><span class="n">icon_path</span><span class="p">)</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="n">icon</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="n">action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>
        <span class="n">action</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">enabled_flag</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">status_tip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">action</span><span class="o">.</span><span class="n">setStatusTip</span><span class="p">(</span><span class="n">status_tip</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">whats_this</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">action</span><span class="o">.</span><span class="n">setWhatsThis</span><span class="p">(</span><span class="n">whats_this</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">add_to_toolbar</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">add_to_menu</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">addPluginToVectorMenu</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">menu</span><span class="p">,</span>
                <span class="n">action</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">action</span>

    <span class="k">def</span> <span class="nf">initGui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create the menu entries and toolbar icons inside the QGIS GUI.&quot;&quot;&quot;</span>

        <span class="n">icon_path</span> <span class="o">=</span> <span class="s1">&#39;:/plugins/SaveAttributes/icon.png&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_action</span><span class="p">(</span>
            <span class="n">icon_path</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;Save Attributes as CSV&#39;</span><span class="p">),</span>
            <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">,</span>
            <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">())</span>


    <span class="k">def</span> <span class="nf">unload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Removes the plugin menu item and icon from QGIS GUI.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">removePluginVectorMenu</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;&amp;Save Attributes&#39;</span><span class="p">),</span>
                <span class="n">action</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">removeToolBarIcon</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="c1"># remove the toolbar</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span>

    <span class="k">def</span> <span class="nf">select_output_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="p">,</span> <span class="s2">&quot;Select output file &quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s1">&#39;*.txt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run method that performs all the real work&quot;&quot;&quot;</span>
        <span class="n">layers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">legendInterface</span><span class="p">()</span><span class="o">.</span><span class="n">layers</span><span class="p">()</span>
        <span class="n">layer_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>
                <span class="n">layer_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">name</span><span class="p">())</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">comboBox</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">comboBox</span><span class="o">.</span><span class="n">addItems</span><span class="p">(</span><span class="n">layer_list</span><span class="p">)</span>
        <span class="c1"># show the dialog</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="c1"># Run the dialog event loop</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
        <span class="c1"># See if OK was pressed</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
            <span class="c1"># Do something useful here - delete the line containing pass and</span>
            <span class="c1"># substitute with your code.</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="n">output_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
           
            <span class="n">selectedLayerIndex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">comboBox</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
            <span class="n">selectedLayer</span> <span class="o">=</span> <span class="n">layers</span><span class="p">[</span><span class="n">selectedLayerIndex</span><span class="p">]</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="n">selectedLayer</span><span class="o">.</span><span class="n">pendingFields</span><span class="p">()</span>
            <span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">()</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">]</span>
            
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">selectedLayer</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">():</span>
                <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">unicode</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fieldnames</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">unicode_line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
                <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">unicode_line</span><span class="p">)</span>
            <span class="n">output_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>





  <div id="disqus_thread"></div>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


    </div>
      
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2019, Ujaval Gandhi.<br/>
      Обновлено: Apr 19, 2019.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.6.<br/>
    </p>
  </div>
</footer>
<div class="container">
  <p>This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/deed.en_US">Creative Commons Attribution 4.0 International License</a></p>
</div>
<!-- Twitter Button -->
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<!-- Disqus comments widget -->
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'qgistutorials'; // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  }());
</script>

<script type="text/javascript">
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

<!-- Script fpr language switching. Largely adapted from https://github.com/pcav/faunalia-website -->
<script>
    var currentPage = 'docs/building_a_python_plugin.html'; // coming from sphinx, always without starting '/'
    var currentLang = 'en';
    $(document).ready(function(){

        var search = new RegExp('\/[a-zA-Z_]{2,8}\/'+ currentPage, 'gi');
        var langPlusPage = window.location.href.match(search);
        // it's possible this is a index.html page called without 'index.html', try without the currentPage
        if (langPlusPage==undefined){
            search = new RegExp('\/[a-zA-Z_]{2,8}\/$', 'gi');
            langPlusPage = window.location.href.match(search);
        }

        // it's possible this is an index.html page called without 'index.html', try removing index.html
        if (langPlusPage==undefined){
            currentPage = currentPage.replace('index.html','')
            search = new RegExp('\/[a-zA-Z_]{2,8}\/'+ currentPage, 'gi');
            langPlusPage = window.location.href.match(search);
        }
        // still no langPlugPage: stop, because the language swicher will misbehave 

        if (langPlusPage == undefined || langPlusPage.length != 1){
            alert('You hit an error, please report back to us.');
            return;
        }
        langPlusPage = langPlusPage[0];
        currentLang = langPlusPage.replace(currentPage, '');

        $("#languages").val(currentLang.replace(/\//g,'')); // currentLang is something like '/nl/'

        $("#languages").change(function() {
            gotoLang($(this).val());
        });

    });

    // load current page in a different language
    function gotoLang(lang){
        var currentUrl = window.location.href;
        var newUrl = currentUrl.replace(currentLang, '/'+lang+'/');
        window.location.href = newUrl;
    }
</script>

  </body>
</html>